<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Book Library</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
    :root {
      --bg:#080c10; --surface:#0e1318; --card:#12181f; --border:#1e2a35;
      --accent:#00e5ff; --accent2:#7c3aed; --red:#ef4444;
      --text:#e2e8f0; --muted:#64748b; --glow:0 0 30px rgba(0,229,255,0.15);
    }
    html { scroll-behavior:smooth; }
    body { background:var(--bg); color:var(--text); font-family:'Syne',sans-serif; min-height:100vh; }
    body::after { content:''; position:fixed; inset:0; background-image:linear-gradient(rgba(0,229,255,0.02) 1px,transparent 1px),linear-gradient(90deg,rgba(0,229,255,0.02) 1px,transparent 1px); background-size:60px 60px; pointer-events:none; z-index:0; }

    /* â”€â”€ AUTH SCREEN â”€â”€ */
    #authScreen {
      position:fixed; inset:0; z-index:100;
      display:flex; align-items:center; justify-content:center;
      background:var(--bg);
    }
    .auth-box {
      background:var(--card); border:1px solid var(--border); border-radius:20px;
      padding:2.5rem; width:90%; max-width:420px; position:relative; z-index:1;
      box-shadow: 0 0 60px rgba(0,229,255,0.08);
    }
    .auth-logo { font-family:'Space Mono',monospace; color:var(--accent); font-size:0.85rem; margin-bottom:1.5rem; letter-spacing:0.1em; }
    .auth-title { font-size:1.8rem; font-weight:800; margin-bottom:0.4rem; }
    .auth-sub { color:var(--muted); font-size:0.9rem; margin-bottom:2rem; }
    .auth-tabs { display:flex; gap:0; margin-bottom:2rem; border:1px solid var(--border); border-radius:8px; overflow:hidden; }
    .auth-tab { flex:1; padding:0.65rem; text-align:center; font-family:'Space Mono',monospace; font-size:0.75rem; letter-spacing:0.05em; cursor:pointer; transition:all 0.2s; color:var(--muted); background:transparent; border:none; }
    .auth-tab.active { background:var(--accent); color:#080c10; font-weight:700; }
    .form-group { margin-bottom:1.2rem; }
    .form-group label { display:block; font-family:'Space Mono',monospace; font-size:0.7rem; letter-spacing:0.1em; color:var(--muted); margin-bottom:0.5rem; }
    .form-group input {
      width:100%; padding:0.8rem 1rem; background:var(--surface); border:1px solid var(--border);
      border-radius:8px; color:var(--text); font-family:'Syne',sans-serif; font-size:0.95rem;
      transition:border-color 0.2s; outline:none;
    }
    .form-group input:focus { border-color:var(--accent); box-shadow:0 0 0 3px rgba(0,229,255,0.08); }
    .btn-full {
      width:100%; padding:0.9rem; background:var(--accent); color:#080c10; border:none;
      border-radius:8px; font-family:'Space Mono',monospace; font-size:0.85rem; font-weight:700;
      letter-spacing:0.05em; cursor:pointer; transition:all 0.25s; margin-top:0.5rem;
    }
    .btn-full:hover { box-shadow:0 0 30px rgba(0,229,255,0.4); transform:translateY(-1px); }
    .auth-error { background:rgba(239,68,68,0.1); border:1px solid rgba(239,68,68,0.3); color:#fca5a5; padding:0.75rem 1rem; border-radius:8px; font-size:0.85rem; margin-top:1rem; display:none; }

    /* â”€â”€ APP SCREEN â”€â”€ */
    #appScreen { display:none; min-height:100vh; position:relative; z-index:1; }

    /* NAV */
    nav {
      position:sticky; top:0; z-index:50;
      display:flex; align-items:center; justify-content:space-between;
      padding:1rem 5vw; background:rgba(8,12,16,0.9);
      backdrop-filter:blur(16px); border-bottom:1px solid var(--border);
    }
    .nav-logo { font-family:'Space Mono',monospace; color:var(--accent); font-size:0.9rem; }
    .nav-right { display:flex; align-items:center; gap:1.5rem; }
    .nav-user { font-family:'Space Mono',monospace; font-size:0.75rem; color:var(--muted); }
    .nav-user span { color:var(--accent); }
    .btn-logout {
      padding:0.45rem 1rem; background:transparent; border:1px solid var(--border);
      border-radius:6px; color:var(--muted); font-family:'Space Mono',monospace;
      font-size:0.7rem; cursor:pointer; transition:all 0.2s; letter-spacing:0.05em;
    }
    .btn-logout:hover { border-color:var(--red); color:var(--red); }

    /* MAIN */
    main { padding:3rem 5vw; max-width:1200px; margin:0 auto; }

    .page-title { font-size:clamp(1.8rem,4vw,2.5rem); font-weight:800; letter-spacing:-0.02em; margin-bottom:0.5rem; }
    .page-sub { color:var(--muted); font-size:0.95rem; margin-bottom:2.5rem; }
    .page-sub span { color:var(--accent); }

    /* ADD BOOK */
    .add-section {
      background:var(--card); border:1px solid var(--border); border-radius:16px;
      padding:2rem; margin-bottom:3rem;
    }
    .add-label { font-family:'Space Mono',monospace; font-size:0.7rem; letter-spacing:0.15em; color:var(--accent); margin-bottom:1rem; }
    .add-row { display:flex; gap:1rem; align-items:flex-end; flex-wrap:wrap; }
    .add-row .form-group { flex:1; min-width:200px; margin:0; }
    .btn-add {
      padding:0.8rem 2rem; background:var(--accent); color:#080c10; border:none;
      border-radius:8px; font-family:'Space Mono',monospace; font-size:0.8rem; font-weight:700;
      cursor:pointer; transition:all 0.25s; white-space:nowrap; letter-spacing:0.05em;
    }
    .btn-add:hover { box-shadow:0 0 20px rgba(0,229,255,0.4); transform:translateY(-1px); }
    .btn-add:disabled { opacity:0.5; cursor:not-allowed; transform:none; box-shadow:none; }
    .add-feedback { margin-top:1rem; font-family:'Space Mono',monospace; font-size:0.8rem; display:none; }
    .add-feedback.error { color:#fca5a5; }
    .add-feedback.loading { color:var(--muted); }
    .add-feedback.success { color:#6ee7b7; }

    /* STATS */
    .stats-row { display:flex; gap:1rem; margin-bottom:2.5rem; flex-wrap:wrap; }
    .stat-pill {
      background:var(--card); border:1px solid var(--border); border-radius:10px;
      padding:0.75rem 1.5rem; font-family:'Space Mono',monospace; font-size:0.75rem; color:var(--muted);
    }
    .stat-pill strong { color:var(--accent); font-size:1.1rem; display:block; }

    /* SEARCH */
    .search-bar {
      width:100%; padding:0.8rem 1rem; background:var(--card); border:1px solid var(--border);
      border-radius:10px; color:var(--text); font-family:'Syne',sans-serif; font-size:0.95rem;
      outline:none; transition:border-color 0.2s; margin-bottom:2rem;
    }
    .search-bar:focus { border-color:var(--accent); }
    .search-bar::placeholder { color:var(--muted); }

    /* BOOK GRID */
    .books-grid {
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(170px, 1fr));
      gap:1.5rem;
    }

    .book-card {
      background:var(--card); border:1px solid var(--border); border-radius:14px;
      overflow:hidden; transition:all 0.3s; position:relative; cursor:default;
    }
    .book-card:hover { transform:translateY(-6px); box-shadow:var(--glow); border-color:rgba(0,229,255,0.3); }
    .book-cover {
      width:100%; aspect-ratio:2/3; object-fit:cover; display:block;
      background:var(--surface);
    }
    .book-cover-placeholder {
      width:100%; aspect-ratio:2/3; background:linear-gradient(135deg,var(--surface),var(--border));
      display:flex; align-items:center; justify-content:center;
      font-size:2.5rem;
    }
    .book-info { padding:0.9rem; }
    .book-title { font-size:0.85rem; font-weight:700; line-height:1.3; margin-bottom:0.3rem; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }
    .book-author { font-size:0.75rem; color:var(--muted); display:-webkit-box; -webkit-line-clamp:1; -webkit-box-orient:vertical; overflow:hidden; }
    .book-isbn { font-family:'Space Mono',monospace; font-size:0.65rem; color:var(--border); margin-top:0.4rem; }
    .book-delete {
      position:absolute; top:0.5rem; right:0.5rem;
      width:28px; height:28px; background:rgba(239,68,68,0.15); border:1px solid rgba(239,68,68,0.3);
      border-radius:50%; color:#fca5a5; font-size:0.75rem; cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      opacity:0; transition:opacity 0.2s; line-height:1;
    }
    .book-card:hover .book-delete { opacity:1; }
    .book-delete:hover { background:rgba(239,68,68,0.35); }

    /* EMPTY */
    .empty-state {
      text-align:center; padding:4rem 2rem; color:var(--muted);
      border:2px dashed var(--border); border-radius:16px;
    }
    .empty-state .icon { font-size:3rem; margin-bottom:1rem; }
    .empty-state p { font-size:0.95rem; }

    /* TOAST */
    .toast {
      position:fixed; bottom:2rem; right:2rem; z-index:999;
      background:var(--card); border:1px solid var(--border); border-radius:10px;
      padding:1rem 1.5rem; font-family:'Space Mono',monospace; font-size:0.8rem;
      transform:translateY(80px); opacity:0; transition:all 0.3s;
      max-width:320px;
    }
    .toast.show { transform:translateY(0); opacity:1; }
    .toast.success { border-color:rgba(16,185,129,0.4); color:#6ee7b7; }
    .toast.error { border-color:rgba(239,68,68,0.4); color:#fca5a5; }

    @media(max-width:600px) {
      .add-row { flex-direction:column; }
      .btn-add { width:100%; }
      .books-grid { grid-template-columns:repeat(auto-fill, minmax(140px,1fr)); }
    }
  </style>
</head>
<body>

<!-- â”€â”€ AUTH SCREEN â”€â”€ -->
<div id="authScreen">
  <div class="auth-box">
    <div class="auth-logo">ðŸ“š BOOK LIBRARY</div>
    <h1 class="auth-title">Welcome Back</h1>
    <p class="auth-sub">Sign in to access your personal book collection.</p>
    <div class="auth-tabs">
      <button class="auth-tab active" onclick="switchTab('login')">SIGN IN</button>
      <button class="auth-tab" onclick="switchTab('signup')">SIGN UP</button>
    </div>
    <!-- Login -->
    <div id="loginForm">
      <div class="form-group">
        <label>USERNAME</label>
        <input type="text" id="loginUser" placeholder="your username" autocomplete="username"/>
      </div>
      <div class="form-group">
        <label>PASSWORD</label>
        <input type="password" id="loginPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password"/>
      </div>
      <button class="btn-full" onclick="login()">SIGN IN â†’</button>
      <div class="auth-error" id="loginError"></div>
    </div>
    <!-- Signup -->
    <div id="signupForm" style="display:none">
      <div class="form-group">
        <label>USERNAME</label>
        <input type="text" id="signupUser" placeholder="choose a username" autocomplete="username"/>
      </div>
      <div class="form-group">
        <label>PASSWORD</label>
        <input type="password" id="signupPass" placeholder="choose a password" autocomplete="new-password"/>
      </div>
      <div class="form-group">
        <label>CONFIRM PASSWORD</label>
        <input type="password" id="signupPass2" placeholder="confirm password" autocomplete="new-password"/>
      </div>
      <button class="btn-full" onclick="signup()">CREATE ACCOUNT â†’</button>
      <div class="auth-error" id="signupError"></div>
    </div>
  </div>
</div>

<!-- â”€â”€ APP SCREEN â”€â”€ -->
<div id="appScreen">
  <nav>
    <div class="nav-logo">ðŸ“š BOOK LIBRARY</div>
    <div class="nav-right">
      <div class="nav-user">Logged in as <span id="navUsername"></span></div>
      <button class="btn-logout" onclick="logout()">SIGN OUT</button>
    </div>
  </nav>

  <main>
    <h1 class="page-title" id="pageTitle">My Library</h1>
    <p class="page-sub">Your personal collection Â· <span id="bookCount">0</span> books</p>

    <!-- Add Book -->
    <div class="add-section">
      <div class="add-label">+ ADD A BOOK BY ISBN</div>
      <div class="add-row">
        <div class="form-group">
          <label>ISBN NUMBER</label>
          <input type="text" id="isbnInput" placeholder="e.g. 9780140449136" maxlength="20"
            onkeydown="if(event.key==='Enter')addBook()"/>
        </div>
        <button class="btn-add" id="addBtn" onclick="addBook()">FETCH &amp; ADD</button>
      </div>
      <div class="add-feedback" id="addFeedback"></div>
    </div>

    <!-- Stats -->
    <div class="stats-row" id="statsRow" style="display:none">
      <div class="stat-pill"><strong id="statTotal">0</strong>Total Books</div>
      <div class="stat-pill"><strong id="statRecent">â€”</strong>Last Added</div>
    </div>

    <!-- Search -->
    <input class="search-bar" type="text" id="searchBar" placeholder="ðŸ”  Search your library by title or author..." oninput="renderBooks()" style="display:none"/>

    <!-- Books Grid -->
    <div id="booksGrid" class="books-grid"></div>
    <div id="emptyState" class="empty-state">
      <div class="icon">ðŸ“–</div>
      <p>Your library is empty.<br>Add your first book by entering an ISBN above!</p>
    </div>
  </main>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
  // â”€â”€ STORAGE HELPERS â”€â”€
  function getUsers() { return JSON.parse(localStorage.getItem('bl_users')||'{}'); }
  function saveUsers(u) { localStorage.setItem('bl_users',JSON.stringify(u)); }
  function getCurrentUser() { return localStorage.getItem('bl_current')||null; }
  function getBooks(username) {
    const users=getUsers();
    return users[username]?.books||[];
  }
  function saveBooks(username, books) {
    const users=getUsers();
    if(!users[username]) return;
    users[username].books=books;
    saveUsers(users);
  }

  // â”€â”€ AUTH â”€â”€
  let currentUser=null;

  function switchTab(tab) {
    document.getElementById('loginForm').style.display=tab==='login'?'block':'none';
    document.getElementById('signupForm').style.display=tab==='signup'?'block':'none';
    document.querySelectorAll('.auth-tab').forEach((t,i)=>{
      t.classList.toggle('active',(tab==='login'&&i===0)||(tab==='signup'&&i===1));
    });
  }

  function showAuthError(id,msg) {
    const el=document.getElementById(id);
    el.textContent=msg; el.style.display='block';
    setTimeout(()=>el.style.display='none',4000);
  }

  function login() {
    const u=document.getElementById('loginUser').value.trim();
    const p=document.getElementById('loginPass').value;
    if(!u||!p) return showAuthError('loginError','Please fill in all fields.');
    const users=getUsers();
    if(!users[u]) return showAuthError('loginError','Username not found.');
    if(users[u].password!==btoa(p)) return showAuthError('loginError','Incorrect password.');
    localStorage.setItem('bl_current',u);
    loadApp(u);
  }

  function signup() {
    const u=document.getElementById('signupUser').value.trim();
    const p=document.getElementById('signupPass').value;
    const p2=document.getElementById('signupPass2').value;
    if(!u||!p||!p2) return showAuthError('signupError','Please fill in all fields.');
    if(u.length<3) return showAuthError('signupError','Username must be at least 3 characters.');
    if(p.length<6) return showAuthError('signupError','Password must be at least 6 characters.');
    if(p!==p2) return showAuthError('signupError','Passwords do not match.');
    const users=getUsers();
    if(users[u]) return showAuthError('signupError','Username already taken.');
    users[u]={password:btoa(p),books:[]};
    saveUsers(users);
    localStorage.setItem('bl_current',u);
    loadApp(u);
  }

  function logout() {
    localStorage.removeItem('bl_current');
    currentUser=null;
    document.getElementById('appScreen').style.display='none';
    document.getElementById('authScreen').style.display='flex';
    document.getElementById('loginUser').value='';
    document.getElementById('loginPass').value='';
  }

  function loadApp(username) {
    currentUser=username;
    document.getElementById('authScreen').style.display='none';
    document.getElementById('appScreen').style.display='block';
    document.getElementById('navUsername').textContent=username;
    document.getElementById('pageTitle').textContent=username+"'s Library";
    renderBooks();
  }

  // â”€â”€ BOOK FETCHING â”€â”€
  async function addBook() {
    const isbn=document.getElementById('isbnInput').value.trim().replace(/[-\s]/g,'');
    if(!isbn) return showFeedback('Please enter an ISBN number.','error');
    if(!/^\d{10}(\d{3})?$/.test(isbn)) return showFeedback('Enter a valid 10 or 13-digit ISBN.','error');

    const books=getBooks(currentUser);
    if(books.find(b=>b.isbn===isbn)) return showFeedback('This book is already in your library!','error');

    showFeedback('Looking up book...','loading');
    document.getElementById('addBtn').disabled=true;

    try {
      const res=await fetch(`https://openlibrary.org/api/books?bibkeys=ISBN:${isbn}&format=json&jscmd=data`);
      const data=await res.json();
      const key=`ISBN:${isbn}`;
      if(!data[key]) {
        showFeedback('Book not found. Check the ISBN and try again.','error');
        document.getElementById('addBtn').disabled=false;
        return;
      }
      const info=data[key];
      const book={
        isbn,
        title: info.title||'Unknown Title',
        authors: info.authors?.map(a=>a.name).join(', ')||'Unknown Author',
        cover: info.cover?.medium||info.cover?.small||null,
        addedAt: new Date().toLocaleDateString('en-IN',{day:'numeric',month:'short',year:'numeric'})
      };
      books.unshift(book);
      saveBooks(currentUser,books);
      document.getElementById('isbnInput').value='';
      showFeedback(`"${book.title}" added to your library!`,'success');
      renderBooks();
      showToast(`ðŸ“š "${book.title}" added!`,'success');
    } catch(e) {
      showFeedback('Network error. Please check your connection.','error');
    }
    document.getElementById('addBtn').disabled=false;
  }

  function showFeedback(msg,type) {
    const el=document.getElementById('addFeedback');
    el.textContent=type==='loading'?'â³ '+msg:type==='error'?'âœ— '+msg:'âœ“ '+msg;
    el.className='add-feedback '+type;
    el.style.display='block';
    if(type!=='loading') setTimeout(()=>el.style.display='none',4000);
  }

  // â”€â”€ RENDER BOOKS â”€â”€
  function renderBooks() {
    const books=getBooks(currentUser);
    const query=document.getElementById('searchBar').value.toLowerCase();
    const filtered=books.filter(b=>
      b.title.toLowerCase().includes(query)||
      b.authors.toLowerCase().includes(query)
    );

    document.getElementById('bookCount').textContent=books.length;
    document.getElementById('statTotal').textContent=books.length;
    document.getElementById('statRecent').textContent=books[0]?.addedAt||'â€”';

    const grid=document.getElementById('booksGrid');
    const empty=document.getElementById('emptyState');
    const statsRow=document.getElementById('statsRow');
    const searchBar=document.getElementById('searchBar');

    if(books.length===0){
      grid.style.display='none'; empty.style.display='block';
      statsRow.style.display='none'; searchBar.style.display='none';
      return;
    }
    empty.style.display='none'; grid.style.display='grid';
    statsRow.style.display='flex'; searchBar.style.display='block';

    grid.innerHTML='';
    if(filtered.length===0){
      grid.innerHTML='<p style="color:var(--muted);font-family:Space Mono,monospace;font-size:0.8rem;grid-column:1/-1;">No books match your search.</p>';
      return;
    }

    filtered.forEach(book=>{
      const card=document.createElement('div');
      card.className='book-card';
      card.innerHTML=`
        <button class="book-delete" onclick="deleteBook('${book.isbn}',event)" title="Remove">âœ•</button>
        ${book.cover
          ?`<img class="book-cover" src="${book.cover}" alt="${book.title}" loading="lazy" onerror="this.outerHTML='<div class=\\'book-cover-placeholder\\'>ðŸ“˜</div>'">`
          :`<div class="book-cover-placeholder">ðŸ“˜</div>`}
        <div class="book-info">
          <div class="book-title">${book.title}</div>
          <div class="book-author">${book.authors}</div>
          <div class="book-isbn">${book.isbn}</div>
        </div>
      `;
      grid.appendChild(card);
    });
  }

  function deleteBook(isbn,e) {
    e.stopPropagation();
    let books=getBooks(currentUser);
    const book=books.find(b=>b.isbn===isbn);
    books=books.filter(b=>b.isbn!==isbn);
    saveBooks(currentUser,books);
    renderBooks();
    showToast(`ðŸ—‘ï¸ "${book?.title||'Book'}" removed.`,'error');
  }

  // â”€â”€ TOAST â”€â”€
  function showToast(msg,type='success') {
    const t=document.getElementById('toast');
    t.textContent=msg; t.className='toast '+type+' show';
    setTimeout(()=>t.className='toast '+type,3000);
  }

  // â”€â”€ INIT â”€â”€
  const saved=getCurrentUser();
  if(saved && getUsers()[saved]) {
    loadApp(saved);
  }

  // Enter key on auth inputs
  document.addEventListener('keydown',e=>{
    if(e.key==='Enter'){
      if(document.getElementById('loginForm').style.display!=='none') login();
      else signup();
    }
  });
</script>
</body>
</html>
